import Bluebird from 'bluebird';
import { TestService } from '../../test/test.service';

const cords = [
  [-87.313757, 20.400012],
  [-86.8611728233555, 20.8670315577455],
  [-174.01554, -18.66527],
  [-87.7066040039062, 18.7193613249976],
  [-149.829483032227, -17.5352044869822],
  [-67.0473432538711, 17.9541020491145],
  [34.9207609333097, 29.50454117398],
  [-2.58865356445312, 49.4450959268882],
  [-77.8882598876953, 18.0267306935119],
  [-61.8047046661378, 17.0105265741075],
  [-64.714093, 18.343798],
  [-122.744643688202, 48.0322148013345],
  [144.799093902, 13.425824584],
  [-88.8915824890137, 13.3012054997471],
  [-76.8177359798653, 17.9197520617254],
  [-71.0952812433243, 42.3609746072678],
  [-156.616914, 20.803371],
  [115.456559099257, -8.71542295525219],
  [92.5848770141601, 11.5091790079464],
  [-159.7632, -21.2126],
  [165.993, -21.94884],
  [-68.286191756, 12.162958419],
  [-23.7368202209473, 15.0210982256932],
  [-84.45726, 29.92737],
  [-8.33162949163266, 55.0461249496022],
  [-35.1039, -8.74845],
  [-81.869773865, 9.141757494],
  [-159.773852654571, -21.2009604541666],
  [-70.6252211316858, 41.7376638417312],
  [-68.371430891902, -54.8424883101483],
  [-72.767609305, 41.256952501],
  [-118.34583, 33.72054],
  [-121.6272, 36.1045],
  [-122.91021, 38.00028],
  [-118.31524, 33.71321],
  [-156.61825, 20.80562],
  [-72.75235, 41.26645],
  [-123.24615, 38.51035],
  [-123.24579, 38.51017],
  [-123.31019, 38.55353],
  [43.91784, -24.6554],
  [-122.34404, 47.67904],
  [-3.53479, 36.71251],
  [-3.52944, 36.7152],
  [123.24565, 9.1615],
];

test('finds nearest noaa available point', async () => {
  console.error(process.env);
  const testService = TestService.getInstance();
  const noaaAvailability = await testService.getNOAAAvailability();
  const result = await Bluebird.Promise.map(cords, ([lon, lat]) => {
    return noaaAvailability.getNearestAvailablePoint(lon, lat);
  });

  expect(result).toEqual([
    [-87.3, 20.4],
    [-86.85, 20.85],
    [-173.95, -18.65],
    [-87.7, 18.7],
    [-149.85, -17.5],
    [-67.05, 17.9],
    [34.95, 29.5],
    [-2.6, 49.45],
    [-77.9, 17.95],
    [-61.8, 16.95],
    [-64.7, 18.35],
    [-122.75, 48.05],
    [144.8, 13.45],
    [-88.9, 13.25],
    [-76.8, 17.9],
    [-71, 42.35],
    [-156.6, 20.75],
    [115.45, -8.7],
    [92.6, 11.55],
    [-159.75, -21.2],
    [166, -21.95],
    [-68.25, 12.15],
    [-23.75, 14.95],
    [-84.45, 29.95],
    [-8.35, 55.05],
    [-35.1, -8.75],
    [-81.85, 9.15],
    [-159.75, -21.2],
    [-70.55, 41.75],
    [-68.3, -54.85],
    [-72.75, 41.2],
    [-118.3, 33.7],
    [-121.65, 36.05],
    [-122.9, 37.95],
    [-118.3, 33.7],
    [-156.6, 20.75],
    [-72.75, 41.2],
    [-123.25, 38.45],
    [-123.25, 38.45],
    [-123.3, 38.5],
    [43.9, -24.75],
    [-122.35, 47.85],
    [-3.55, 36.65],
    [-3.55, 36.65],
    [123.25, 9.15],
  ]);
});
